PREFIX dcat: <http://www.w3.org/ns/dcat#>
PREFIX dcterms: <http://purl.org/dc/terms/>

DELETE {
	?catalog dcat:dataset ?dataset .
	?dataset ?p ?o .
	?dataset dcat:distribution ?dist .
	?dist ?p2 ?o2
}
WHERE { 
	?catalog dcat:dataset ?dataset .
	?dataset a dcat:Dataset . 
	?dataset ?p ?o .
	?dataset dcterms:title ?title . 
		{ 
			SELECT(MIN(?s) as ?id) ?title 
			WHERE { ?s a dcat:Dataset . 
					?s dcterms:title ?title } 
			GROUP BY ?title 
			HAVING (COUNT(?title) > 1) 
		}
	FILTER (?id != ?dataset) 
	OPTIONAL {
		?dataset dcat:distribution ?dist .
		?dist ?p2 ?o2
		}
	}